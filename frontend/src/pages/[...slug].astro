---
import { getAllStaticPaths } from "@apostrophecms/apostrophe-astro/lib/static.js";
import aposPageFetch from "@apostrophecms/apostrophe-astro/lib/aposPageFetch.js";
import AposLayout from "@apostrophecms/apostrophe-astro/components/layouts/AposLayout.astro";
import AposTemplate from "@apostrophecms/apostrophe-astro/components/AposTemplate.astro";
import SiteHeader from "../components/SiteHeader.astro";
import SiteFooter from "../components/SiteFooter.astro";
import "../styles/scss/index.scss";
import "../styles/app.css";
import "../styles/styles.css";

export async function getStaticPaths() {
  return getAllStaticPaths({
    aposHost: import.meta.env.APOS_HOST || "http://localhost:3000",
    aposExternalFrontKey: import.meta.env.APOS_EXTERNAL_FRONT_KEY,
  });
}

const aposData = await aposPageFetch(Astro.request);

// Determine body class based on page type
const isHomePage = aposData.page?.type === "@apostrophecms/home-page";
const bodyClass = isHomePage ? "home-page" : "";

// Get title
const title = aposData.piece?.title || aposData.page?.title;
const siteTitle = aposData.global?.siteTitle || "ApostropheCMS Demo";

if (aposData.redirect) {
  return Astro.redirect(aposData.url, aposData.status);
}
if (aposData.notFound) {
  Astro.response.status = 404;
}
---

<AposLayout title={`${title} - ${siteTitle}`} {aposData} {bodyClass}>
  <Fragment slot="standardHead">
    <meta name="description" content={aposData.page?.seoDescription} />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="UTF-8" />
    <link
      rel="preload"
      href="/fonts/poppins.subset.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/quicksand.subset.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/roboto.subset.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/roboto-italic.subset.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
  </Fragment>

  <SiteHeader {aposData} slot="beforeMain" />

  <AposTemplate {aposData} slot="main" />

  <SiteFooter slot="afterMain" />
</AposLayout>
